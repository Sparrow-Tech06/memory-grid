<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Memory Flash Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
:root { --p-color: #34495e; }
body { background: #fff; font-family: system-ui; overflow: hidden; color: #2c3e50; }

[v-cloak] { display: none; }

/* Loading Animation */
.loading-text { font-size: 1.2rem; font-weight: 600; letter-spacing: 2px; animation: pulse 1.5s infinite; }

/* Grid & UI */
.grid { display: grid; gap: 10px; margin: 20px auto; max-width: 320px; }
.cell {
  background: transparent; border: 1.5px solid #333; border-radius: 12px;
  aspect-ratio: 1; cursor: pointer; transition: 0.3s;
}
.cell.active, .cell.correct { background: var(--p-color) !important; border-color: var(--p-color) !important; }
.cell.wrong { background: #ff7675 !important; border-color: #ff7675 !important; animation: shakeX 0.4s; }

.btn-pill {
  border: 2px solid #333; background: #fff; border-radius: 50px;
  padding: 10px 45px; font-weight: 700; transition: 0.2s;
}

/* Bottom Nav Icons */
.bottom-nav { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; }
.bottom-nav a { color: #333; font-size: 1.6rem; text-decoration: none; transition: 0.3s; }
.bottom-nav a:hover { transform: translateY(-5px); }

/* Popup */
.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px);
}
.popup-content { background: #fff; padding: 35px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }

.timer-text { font-size: 1.2rem; font-weight: bold; color: #e74c3c; }
</style>
</head>

<body>

<div id="app" v-cloak class="container min-vh-100 d-flex flex-column align-items-center justify-content-center">

  <div v-if="loading" class="animate__animated animate__fadeIn">
    <div class="loading-text">LOADING...</div>
  </div>

  <template v-else>
    
    <div v-if="screen === 'menu'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="grid mb-4" style="grid-template-columns: repeat(3, 1fr);">
        <div v-for="i in 9" :key="i" class="cell" :class="{'active': [2,4,6,8].includes(i)}"></div>
      </div>

      <div class="mb-4 d-flex justify-content-center gap-3">
        <div v-for="t in jsonData.themes" :key="t.color" 
             class="color-dot" :style="{background: t.color, width: '30px', height: '30px', borderRadius: '50%', cursor: 'pointer', border: activeTheme === t.color ? '3px solid #000' : '1px solid #ddd'}"
             @click="setTheme(t.color)"></div>
      </div>

      <button class="btn btn-pill mb-5" @click="screen = 'game'">START GAME</button>

      <div class="bottom-nav">
        <a href="#"><i class="bi bi-gear"></i></a>
        <a href="#"><i class="bi bi-list-stars"></i></a>
        <a href="#"><i class="bi bi-info-circle"></i></a>
      </div>
    </div>

    <div v-if="screen === 'game'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="position-absolute top-0 start-0 p-3" @click="screen = 'menu'"><i class="bi bi-chevron-left h4"></i></div>
      
      <div class="d-flex justify-content-between px-4 mb-3" style="max-width: 400px; margin: auto;">
        <span class="badge border text-dark">Level: {{ level }}</span>
        <span class="badge border text-dark">Best: {{ highScore }}</span>
      </div>

      <div style="height: 30px;" class="mb-2">
        <div v-if="status === 'count'" class="timer-text animate__animated animate__pulse animate__infinite">
          Ready in: {{ countdown }}s
        </div>
        <div v-else-if="status === 'play'" class="text-success fw-bold">GO!</div>
        <div v-else-if="status === 'memo'" class="text-muted small">Memorize...</div>
      </div>

      <div class="grid" :style="{gridTemplateColumns: `repeat(${gridSize}, 1fr)`}">
        <div v-for="(c, i) in (gridSize * gridSize)" :key="i" 
             class="cell" :class="cellLogic(i)" @click="hit(i)"></div>
      </div>

      <button v-if="status === 'idle'" class="btn btn-pill" @click="play">TAP TO START</button>
      <button v-else class="btn btn-link text-muted text-decoration-none" @click="play" style="font-size:0.8rem">Restart Level</button>
    </div>

    <div v-if="pop.show" class="popup-overlay animate__animated animate__fadeIn">
      <div class="popup-content animate__animated animate__zoomIn">
        <h2 class="fw-bold" :class="pop.win ? 'text-success':'text-danger'">{{ pop.title }}</h2>
        <p class="text-muted">{{ pop.msg }}</p>
        <button class="btn btn-pill w-100 mt-3" 
                :style="{background: activeTheme, color: '#fff', border: 'none'}" @click="next">
          CONTINUE
        </button>
      </div>
    </div>

  </template>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: true,
      screen: 'menu',
      level: 1,
      highScore: localStorage.getItem('hs') || 0,
      jsonData: null,
      activeTheme: '#34495e',
      status: 'idle',
      countdown: 3,
      gridSize: 3,
      pattern: [],
      userPick: [],
      pop: { show: false, title: '', msg: '', win: false }
    }
  },
  mounted() {
    fetch('config.json')
      .then(r => r.json())
      .then(data => {
        this.jsonData = data;
        setTimeout(() => { this.loading = false; }, 800); 
      })
      .catch(e => {
        console.error("JSON Error");
        this.loading = false;
      });
  },
  methods: {
    setTheme(c) {
      this.activeTheme = c;
      document.documentElement.style.setProperty('--p-color', c);
    },
    play() {
      this.status = 'memo';
      this.userPick = [];
      this.pattern = [];
      this.gridSize = Math.floor(this.level / 4) + 3;
      
      const pCount = 2 + Math.floor(this.level / 2);
      while(this.pattern.length < pCount) {
        let r = Math.floor(Math.random() * (this.gridSize * this.gridSize));
        if(!this.pattern.includes(r)) this.pattern.push(r);
      }

      // Memo time then Countdown
      setTimeout(() => { this.startCountdown(); }, this.jsonData.gameSettings.memorizeTime);
    },
    startCountdown() {
      this.status = 'count';
      this.countdown = 3;
      let t = setInterval(() => {
        this.countdown--;
        if(this.countdown === 0) {
          clearInterval(t);
          this.status = 'play';
        }
      }, 1000);
    },
    hit(i) {
      if(this.status !== 'play' || this.userPick.includes(i)) return;
      this.userPick.push(i);
      
      if(!this.pattern.includes(i)) {
        this.pop = { show: true, win: false, title: "Oops!", msg: "Try again!" };
        return;
      }
      
      if(this.userPick.length === this.pattern.length) {
        if(this.level > this.highScore) { 
          this.highScore = this.level; 
          localStorage.setItem('hs', this.level); 
        }
        this.pop = { show: true, win: true, title: "Great Work!", msg: "Level Complete." };
      }
    },
    next() {
      this.pop.show = false;
      this.level = this.pop.win ? this.level + 1 : 1;
      this.play();
    },
    cellLogic(i) {
      if(this.status === 'memo' && this.pattern.includes(i)) return 'active';
      if(this.userPick.includes(i)) return this.pattern.includes(i) ? 'correct' : 'wrong';
      return '';
    }
  }
}).mount('#app');
</script>
</body>
</html>
