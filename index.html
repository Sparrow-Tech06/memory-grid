<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no,viewport-fit=cover">   
    
<title>Memory Flash Pro</title>  
  
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>  
  
<link rel="stylesheet" href="butterfly.css">  
</head>  
  
<body>  
  
<div id="app" v-cloak class="container min-vh-100 d-flex flex-column align-items-center justify-content-center p-0">  
  
  <div v-if="loading" class="loading-screen text-uppercase">Loading...</div>  
  
  <template v-else>  
      
    <!-- MENU -->
    <div v-if="screen === 'menu'" class="w-100 text-center animate__animated animate__fadeIn">  
      <div class="grid mb-4" style="grid-template-columns: repeat(3, 1fr);">  
        <div v-for="i in 9" :key="i" class="cell"
             :class="{'active': jsonData.menuConfig.previewPattern.includes(i)}"></div>  
      </div>  
  
      <div class="theme-wrapper mb-4">  
        <div class="theme-scroll">  
          <div v-for="t in jsonData.themes"  
               :key="t.color"  
               class="color-dot"  
               :title="t.name"  
               :style="{background:t.color,border:activeTheme===t.color?'3px solid #000':'1px solid #ccc'}"  
               @click="setTheme(t.color)">  
          </div>  
        </div>  
      </div>  
  
      <button class="btn btn-pill mb-5" @click="changeScreen('game')">START GAME</button>  
  
      <div class="bottom-nav">  
        <a href="setting.html"><i class="bi bi-gear"></i></a>  
        <a href="#"><i class="bi bi-list-stars"></i></a>  
        <a href="#"><i class="bi bi-info-circle"></i></a>  
      </div>  
    </div>  
  
    <!-- GAME -->
    <div v-if="screen === 'game'" class="w-100 text-center animate__animated animate__fadeIn">  
      <div class="position-absolute top-0 start-0 p-3" @click="changeScreen('menu')" style="cursor:pointer">  
        <i class="bi bi-chevron-left h4"></i>  
      </div>  
  
      <div class="d-flex justify-content-between px-4 mb-4" style="max-width:400px;margin:auto">  
        <span class="badge border text-dark py-2 px-3">LEVEL: {{ level }}</span>  
        <span class="badge border text-dark py-2 px-3">BEST: {{ highScore }}</span>  
      </div>  
  
      <div style="height:35px" class="mb-2">  
        <div v-if="status==='count'" class="timer-text animate__animated animate__pulse animate__infinite">  
          {{ jsonData.messages.readyText }}{{ countdown }}s  
        </div>  
        <div v-else-if="status==='play'" class="text-success fw-bold">{{ jsonData.messages.goText }}</div>  
        <div v-else-if="status==='memo'" class="text-muted fw-bold">{{ jsonData.messages.memoText }}</div>  
      </div>  
  
      <div class="grid" :style="{gridTemplateColumns:`repeat(${gridSize},1fr)`}">  
        <div v-for="(c,i) in gridSize*gridSize" :key="i"
             class="cell" :class="cellLogic(i)" @click="hit(i)"></div>  
      </div>  
  
      <button v-if="status==='idle'" class="btn btn-pill" @click="initGame">TAP TO START</button>  
      <button v-else class="btn btn-link text-muted text-decoration-none mt-2"
              style="font-size:.8rem" @click="initGame">Restart Level</button>  
    </div>  
  
    <!-- POPUP -->
    <div v-if="pop.show" class="popup-overlay animate__animated animate__fadeIn">  
      <div class="popup-content animate__animated animate__zoomIn">  
        <h2 class="fw-bold mb-3"
            :style="{color:pop.win?activeTheme:'#ff4757'}">{{ pop.title }}</h2>  
        <p class="text-muted mb-4">{{ pop.msg }}</p>  
        <button class="btn btn-pill w-100"
                :style="{background:activeTheme,color:'#fff',border:'none'}"
                @click="handlePopupAction">CONTINUE</button>  
      </div>  
    </div>  
  
  </template>  
</div>  
  
<!-- Vue -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<!-- Howler -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  
<script>  
const { createApp } = Vue;  
  
createApp({  
  data() {  
    return {  
      loading: true,  
      screen: 'menu',  
      level: 1,  
      highScore: localStorage.getItem('flash_score') || 0,  
      jsonData: null,  
      activeTheme: '#34495e',  
      status: 'idle',  
      countdown: 3,  
      gridSize: 3,  
      pattern: [],  
      userPick: [],  
      pop: { show:false, title:'', msg:'', win:false },  
      sounds: {}  
    }  
  },  
  mounted() {  

    /* ðŸ”Š MIXKIT SOUNDS */
    this.sounds = {
      click: new Howl({ src:['https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'], volume:0.6 }),
      correct: new Howl({ src:['https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3'], volume:0.7 }),
      wrong: new Howl({ src:['https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3'], volume:0.7 }),
      win: new Howl({ src:['https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'], volume:0.8 }),
      over: new Howl({ src:['https://assets.mixkit.co/active_storage/sfx/957/957-preview.mp3'], volume:0.8 })
    };  

    fetch('config.json?v=' + Date.now())  
      .then(r => r.json())  
      .then(d => {  
        this.jsonData = d;  
        this.activeTheme = d.menuConfig.defaultActiveTheme;  
        this.setTheme(this.activeTheme);  
        setTimeout(()=>this.loading=false,800);  
      });  
  },  
  methods: {  
    setTheme(c){ this.activeTheme=c; document.documentElement.style.setProperty('--p-color',c); },  
    changeScreen(s){ this.screen=s; this.status='idle'; if(s==='game') this.level=1; },  

    initGame(){  
      this.sounds.click.play();  
      this.status='memo';  
      this.userPick=[];  
      this.pattern=[];  
      this.pop.show=false;  

      this.gridSize=Math.floor(this.level/this.jsonData.gameSettings.gridStep)+3;  
      let cnt=Math.floor(this.jsonData.gameSettings.baseTiles+(this.level*this.jsonData.gameSettings.tilesPerLevelInc));  

      while(this.pattern.length<cnt){  
        let r=Math.floor(Math.random()*(this.gridSize*this.gridSize));  
        if(!this.pattern.includes(r)) this.pattern.push(r);  
      }  

      setTimeout(()=>this.startCountdown(),this.jsonData.gameSettings.memorizeTime);  
    },  

    startCountdown(){  
      this.status='count';  
      this.countdown=this.jsonData.gameSettings.countdownSeconds;  
      let t=setInterval(()=>{  
        this.countdown--;  
        if(this.countdown===0){ clearInterval(t); this.status='play'; }  
      },1000);  
    },  

    hit(i){  
      if(this.status!=='play'||this.userPick.includes(i)) return;  
      this.userPick.push(i);  

      if(!this.pattern.includes(i)){  
        this.sounds.wrong.play();  
        this.sounds.over.play();  
        this.status='idle';  
        this.pop={show:true,win:false,title:this.jsonData.messages.lossTitle,msg:this.jsonData.messages.lossMsg};  
        return;  
      }  

      this.sounds.correct.play();  

      if(this.userPick.length===this.pattern.length){  
        this.sounds.win.play();  
        this.status='idle';  
        if(this.level>this.highScore){  
          this.highScore=this.level;  
          localStorage.setItem('flash_score',this.level);  
        }  
        this.pop={show:true,win:true,title:this.jsonData.messages.winTitle,msg:this.jsonData.messages.winMsg};  
      }  
    },  

    handlePopupAction(){  
      this.pop.show=false;  
      this.level=this.pop.win?this.level+1:1;  
      this.initGame();  
    },  

    cellLogic(i){  
      if(this.status==='memo'&&this.pattern.includes(i)) return 'active';  
      if(this.userPick.includes(i)) return this.pattern.includes(i)?'correct':'wrong';  
      return '';  
    }  
  }  
}).mount('#app');  
</script>  
</body>  
                                                   </html>
