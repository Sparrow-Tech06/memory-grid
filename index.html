<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Memory Flash Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
:root { --p-color: #34495e; }
body { background: #fff; font-family: system-ui; overflow: hidden; color: #2c3e50; }

/* Raw Template Brackets ko hide karne ke liye */
[v-cloak] { display: none; }

/* Loading Text Animation */
.loading-screen { font-size: 1.2rem; font-weight: 700; letter-spacing: 2px; animation: pulse 1.5s infinite; }

/* Grid Layout */
.grid { display: grid; gap: 10px; margin: 20px auto; max-width: 320px; }
.cell {
  background: transparent; border: 1.8px solid #333; border-radius: 12px;
  aspect-ratio: 1; cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Dynamic Classes */
.cell.active, .cell.correct { background: var(--p-color) !important; border-color: var(--p-color) !important; }
.cell.wrong { background: #ff7675 !important; border-color: #ff7675 !important; animation: shakeX 0.4s; }

/* Buttons */
.btn-pill {
  border: 2px solid #333; background: #fff; border-radius: 50px;
  padding: 10px 50px; font-weight: 700; transition: 0.2s;
}
.btn-pill:active { transform: scale(0.95); }

/* Menu Bottom Icons */
.bottom-nav { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; }
.bottom-nav a { color: #333; font-size: 1.6rem; text-decoration: none; transition: 0.3s; }
.bottom-nav a:hover { transform: translateY(-5px); color: var(--p-color); }

/* Popup Styling */
.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  display: flex; align-items: center; justify-content: center; z-index: 2000;
  backdrop-filter: blur(4px);
}
.popup-content { background: #fff; padding: 35px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }

/* Timer Display */
.timer-text { font-size: 1.2rem; font-weight: bold; color: #e74c3c; }
</style>
</head>

<body>

<div id="app" v-cloak class="container min-vh-100 d-flex flex-column align-items-center justify-content-center">

  <div v-if="loading" class="loading-screen text-uppercase">Loading...</div>

  <template v-else>
    
    <div v-if="screen === 'menu'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="grid mb-4" style="grid-template-columns: repeat(3, 1fr);">
        <div v-for="i in 9" :key="i" class="cell" :class="{'active': jsonData.menuConfig.previewPattern.includes(i)}"></div>
      </div>

      <div class="mb-4 d-flex justify-content-center gap-3">
        <div v-for="t in jsonData.themes" :key="t.color" 
             class="color-dot" 
             :style="{background: t.color, width: '32px', height: '32px', borderRadius: '50%', cursor: 'pointer', border: activeTheme === t.color ? '3px solid #000' : '1px solid #ddd'}"
             @click="setTheme(t.color)"></div>
      </div>

      <button class="btn btn-pill mb-5" @click="changeScreen('game')">START GAME</button>

      <div class="bottom-nav">
        <a href="https://example.com/settings" target="_blank"><i class="bi bi-gear"></i></a>
        <a href="https://example.com/leaderboard" target="_blank"><i class="bi bi-list-stars"></i></a>
        <a href="https://example.com/about" target="_blank"><i class="bi bi-info-circle"></i></a>
      </div>
    </div>

    <div v-if="screen === 'game'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="position-absolute top-0 start-0 p-3" @click="changeScreen('menu')" style="cursor:pointer">
        <i class="bi bi-chevron-left h4"></i>
      </div>
      
      <div class="d-flex justify-content-between px-4 mb-4" style="max-width: 400px; margin: auto;">
        <span class="badge border text-dark py-2 px-3">LEVEL: {{ level }}</span>
        <span class="badge border text-dark py-2 px-3">BEST: {{ highScore }}</span>
      </div>

      <div style="height: 35px;" class="mb-2">
        <div v-if="status === 'count'" class="timer-text animate__animated animate__pulse animate__infinite">
          {{ jsonData.messages.readyText }}{{ countdown }}s
        </div>
        <div v-else-if="status === 'play'" class="text-success fw-bold">{{ jsonData.messages.goText }}</div>
        <div v-else-if="status === 'memo'" class="text-muted fw-bold">{{ jsonData.messages.memoText }}</div>
      </div>

      <div class="grid" :style="{gridTemplateColumns: `repeat(${gridSize}, 1fr)`}">
        <div v-for="(c, i) in (gridSize * gridSize)" :key="i" 
             class="cell" :class="cellLogic(i)" @click="hit(i)"></div>
      </div>

      <button v-if="status === 'idle'" class="btn btn-pill" @click="initGame">TAP TO START</button>
      <button v-else class="btn btn-link text-muted text-decoration-none mt-2" @click="initGame" style="font-size:0.8rem">Restart Level</button>
    </div>

    <div v-if="pop.show" class="popup-overlay animate__animated animate__fadeIn">
      <div class="popup-content animate__animated animate__zoomIn">
        <h2 class="fw-bold mb-3" :style="{color: pop.win ? activeTheme : '#ff4757'}">{{ pop.title }}</h2>
        <p class="text-muted mb-4">{{ pop.msg }}</p>
        <button class="btn btn-pill w-100" 
                :style="{background: activeTheme, color: '#fff', border: 'none'}" @click="handlePopupAction">
          CONTINUE
        </button>
      </div>
    </div>

  </template>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: true,
      screen: 'menu',
      level: 1,
      highScore: localStorage.getItem('flash_score') || 0,
      jsonData: null,
      activeTheme: '#34495e',
      status: 'idle', // idle, memo, count, play
      countdown: 3,
      gridSize: 3,
      pattern: [],
      userPick: [],
      pop: { show: false, title: '', msg: '', win: false }
    }
  },
  mounted() {
    // JSON file load logic
    fetch('config.json')
      .then(response => response.json())
      .then(data => {
        this.jsonData = data;
        this.activeTheme = data.menuConfig.defaultActiveTheme;
        this.setTheme(this.activeTheme);
        // Chhota sa delay professional feel ke liye
        setTimeout(() => { this.loading = false; }, 800); 
      })
      .catch(error => {
        console.error("JSON Error: Local Server use karein.");
        this.loading = false;
      });
  },
  methods: {
    setTheme(color) {
      this.activeTheme = color;
      document.documentElement.style.setProperty('--p-color', color);
    },
    changeScreen(scr) {
      this.screen = scr;
      this.status = 'idle';
      if(scr === 'game') this.level = 1;
    },
    initGame() {
      this.status = 'memo';
      this.userPick = [];
      this.pattern = [];
      this.pop.show = false;
      
      // JSON based Grid Logic
      this.gridSize = Math.floor(this.level / this.jsonData.gameSettings.gridStep) + 3;
      
      // JSON based Difficulty Logic
      const pCount = Math.floor(this.jsonData.gameSettings.baseTiles + (this.level * this.jsonData.gameSettings.tilesPerLevelInc));
      
      while(this.pattern.length < pCount) {
        let r = Math.floor(Math.random() * (this.gridSize * this.gridSize));
        if(!this.pattern.includes(r)) this.pattern.push(r);
      }

      // Phase Transition
      setTimeout(() => { this.startCountdown(); }, this.jsonData.gameSettings.memorizeTime);
    },
    startCountdown() {
      this.status = 'count';
      this.countdown = this.jsonData.gameSettings.countdownSeconds;
      let timerObj = setInterval(() => {
        this.countdown--;
        if(this.countdown === 0) {
          clearInterval(timerObj);
          this.status = 'play';
        }
      }, 1000);
    },
    hit(index) {
      if(this.status !== 'play' || this.userPick.includes(index)) return;
      
      this.userPick.push(index);
      
      // Wrong Pick
      if(!this.pattern.includes(index)) {
        this.status = 'idle';
        this.pop = { show: true, win: false, title: this.jsonData.messages.lossTitle, msg: this.jsonData.messages.lossMsg };
        return;
      }
      
      // Win Pick
      if(this.userPick.length === this.pattern.length) {
        this.status = 'idle';
        if(this.level > this.highScore) { 
          this.highScore = this.level; 
          localStorage.setItem('flash_score', this.level); 
        }
        this.pop = { show: true, win: true, title: this.jsonData.messages.winTitle, msg: this.jsonData.messages.winMsg };
      }
    },
    handlePopupAction() {
      this.pop.show = false;
      this.level = this.pop.win ? this.level + 1 : 1;
      this.initGame();
    },
    cellLogic(index) {
      if(this.status === 'memo' && this.pattern.includes(index)) return 'active';
      if(this.userPick.includes(index)) {
        return this.pattern.includes(index) ? 'correct' : 'wrong';
      }
      return '';
    }
  }
}).mount('#app');
</script>
</body>
</html>
