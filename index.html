<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Memory Flash JSON Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
:root { --p-color: #34495e; }
body { background: #fff; font-family: system-ui; overflow: hidden; color: #2c3e50; }

.grid { display: grid; gap: 10px; margin: 20px auto; max-width: 320px; }
.cell {
  background: transparent; border: 1.5px solid #333; border-radius: 12px;
  aspect-ratio: 1; cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.cell.active, .cell.correct { background: var(--p-color) !important; border-color: var(--p-color) !important; }
.cell.wrong { background: #ff7675 !important; border-color: #ff7675 !important; animation: shakeX 0.4s; }

.btn-pill {
  border: 2px solid #333; background: #fff; border-radius: 50px;
  padding: 10px 45px; font-weight: 700; transition: 0.2s;
}

.color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.color-dot.selected { transform: scale(1.2); border-color: #000; }

.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  display: flex; align-items: center; justify-content: center; z-index: 1000;
  backdrop-filter: blur(4px);
}
.popup-content { background: #fff; padding: 35px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }

.nav-link-custom { color: #333; font-size: 1.5rem; text-decoration: none; }
</style>
</head>

<body>

<div id="app" class="container min-vh-100 d-flex flex-column align-items-center justify-content-center">

  <div v-if="loading" class="text-center">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2">Loading Config...</p>
  </div>

  <div v-if="!loading && screen === 'menu'" class="w-100 text-center animate__animated animate__fadeIn">
    <div class="grid mb-4" style="grid-template-columns: repeat(3, 1fr);">
      <div v-for="i in 9" :key="i" class="cell" :class="{'active': [2,4,6,8].includes(i)}"></div>
    </div>

    <div class="mb-4">
      <div class="d-flex justify-content-center gap-3">
        <div v-for="t in jsonData.themes" :key="t.color" 
             class="color-dot" :style="{background: t.color}"
             :class="{selected: activeTheme === t.color}"
             @click="setTheme(t.color)"></div>
      </div>
    </div>

    <button class="btn btn-pill" @click="screen = 'game'">START GAME</button>

    <div class="fixed-bottom mb-4 d-flex justify-content-around">
      <a href="#" class="nav-link-custom"><i class="bi bi-gear"></i></a>
      <a href="#" class="nav-link-custom"><i class="bi bi-list-stars"></i></a>
      <a href="#" class="nav-link-custom"><i class="bi bi-info-circle"></i></a>
    </div>
  </div>

  <div v-if="screen === 'game'" class="w-100 text-center animate__animated animate__fadeIn">
    <div class="position-absolute top-0 start-0 p-3" @click="screen = 'menu'"><i class="bi bi-chevron-left h4"></i></div>
    
    <div class="d-flex justify-content-between px-4 mb-4" style="max-width: 400px; margin: auto;">
      <span class="badge border text-dark">Lvl: {{ level }}</span>
      <span class="badge border text-dark">Best: {{ highScore }}</span>
    </div>

    <div style="height: 30px;" class="mb-2">
      <h5 v-if="status === 'count'" class="text-danger">READY: {{ timer }}</h5>
      <h5 v-if="status === 'play'" class="text-success">TAP TILES!</h5>
    </div>

    <div class="grid" :style="{gridTemplateColumns: `repeat(${gridSize}, 1fr)`}">
      <div v-for="(c, i) in (gridSize * gridSize)" :key="i" 
           class="cell" :class="cellLogic(i)" @click="hit(i)"></div>
    </div>

    <button v-if="status === 'idle'" class="btn btn-pill" @click="play">PLAY NOW</button>
  </div>

  <div v-if="pop.show" class="popup-overlay animate__animated animate__fadeIn">
    <div class="popup-content animate__animated animate__zoomIn">
      <h2 :style="{color: pop.win ? activeTheme : '#ff4757'}">{{ pop.title }}</h2>
      <p class="text-muted">{{ pop.msg }}</p>
      <button class="btn btn-pill w-100 mt-3" 
              :style="{background: activeTheme, color: '#fff', border: 'none'}" @click="next">
        CONTINUE
      </button>
    </div>
  </div>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: true,
      screen: 'menu',
      level: 1,
      highScore: localStorage.getItem('hs') || 0,
      jsonData: null,
      activeTheme: '#34495e',
      status: 'idle',
      timer: 3,
      gridSize: 3,
      pattern: [],
      userPick: [],
      pop: { show: false, title: '', msg: '', win: false }
    }
  },
  mounted() {
    // JSON file load ho rahi hai
    fetch('config.json')
      .then(r => r.json())
      .then(data => {
        this.jsonData = data;
        this.loading = false;
      })
      .catch(e => console.error("JSON Error: Local server (VS Code Live Server) zaroori hai."));
  },
  methods: {
    setTheme(c) {
      this.activeTheme = c;
      document.documentElement.style.setProperty('--p-color', c);
    },
    play() {
      this.status = 'memo';
      this.userPick = [];
      this.pattern = [];
      this.gridSize = Math.floor(this.level / 4) + 3;
      
      const pCount = Math.floor(this.jsonData.gameSettings.baseTiles || 2 + (this.level * this.jsonData.gameSettings.tilesPerLevelInc));
      while(this.pattern.length < pCount) {
        let r = Math.floor(Math.random() * (this.gridSize * this.gridSize));
        if(!this.pattern.includes(r)) this.pattern.push(r);
      }

      setTimeout(() => { this.startCount(); }, this.jsonData.gameSettings.memorizeTime);
    },
    startCount() {
      this.status = 'count';
      this.timer = this.jsonData.gameSettings.countdownSeconds;
      let t = setInterval(() => {
        this.timer--;
        if(this.timer === 0) { clearInterval(t); this.status = 'play'; }
      }, 1000);
    },
    hit(i) {
      if(this.status !== 'play' || this.userPick.includes(i)) return;
      this.userPick.push(i);
      if(!this.pattern.includes(i)) {
        this.pop = { show: true, win: false, title: this.jsonData.messages.lossTitle, msg: this.jsonData.messages.lossMsg };
        return;
      }
      if(this.userPick.length === this.pattern.length) {
        if(this.level > this.highScore) { this.highScore = this.level; localStorage.setItem('hs', this.level); }
        this.pop = { show: true, win: true, title: this.jsonData.messages.winTitle, msg: this.jsonData.messages.winMsg };
      }
    },
    next() {
      this.pop.show = false;
      this.level = this.pop.win ? this.level + 1 : 1;
      this.play();
    },
    cellLogic(i) {
      if(this.status === 'memo' && this.pattern.includes(i)) return 'active';
      if(this.userPick.includes(i)) return this.pattern.includes(i) ? 'correct' : 'wrong';
      return '';
    }
  }
}).mount('#app');
</script>
</body>
</html>

