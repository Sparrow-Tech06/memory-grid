<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Memory Flash Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
:root { --p-color: #34495e; }
body { background: #fff; font-family: system-ui; overflow: hidden; color: #2c3e50; }

/* V-CLOAK: Raw brackets ko hide karne ke liye */
[v-cloak] { display: none; }

/* Simple Text Loading Animation */
.loading-text {
  font-size: 1.5rem;
  font-weight: 600;
  letter-spacing: 2px;
  animation: pulseText 1.5s infinite;
}

@keyframes pulseText {
  0% { opacity: 0.3; }
  50% { opacity: 1; }
  100% { opacity: 0.3; }
}

/* Grid & UI logic wahi rahega */
.grid { display: grid; gap: 10px; margin: 20px auto; max-width: 320px; }
.cell {
  background: transparent; border: 1.5px solid #333; border-radius: 12px;
  aspect-ratio: 1; cursor: pointer; transition: 0.3s;
}
.cell.active, .cell.correct { background: var(--p-color) !important; border-color: var(--p-color) !important; }
.cell.wrong { background: #ff7675 !important; border-color: #ff7675 !important; animation: shakeX 0.4s; }

.btn-pill {
  border: 1.8px solid #333; background: #fff; border-radius: 50px;
  padding: 10px 45px; font-weight: 700; transition: 0.2s;
}

.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  display: flex; align-items: center; justify-content: center; z-index: 1000;
  backdrop-filter: blur(4px);
}
.popup-content { background: #fff; padding: 35px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }
</style>
</head>

<body>

<div id="app" v-cloak class="container min-vh-100 d-flex flex-column align-items-center justify-content-center">

  <div v-if="loading" class="animate__animated animate__fadeIn">
    <div class="loading-text text-uppercase">Loading...</div>
  </div>

  <template v-else>
    
    <div v-if="screen === 'menu'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="grid mb-5" style="grid-template-columns: repeat(3, 1fr);">
        <div v-for="i in 9" :key="i" class="cell" :class="{'active': [1,3,5,7,9].includes(i)}"></div>
      </div>

      <div class="mb-4">
        <div class="d-flex justify-content-center gap-3">
          <div v-for="t in jsonData.themes" :key="t.color" 
               class="color-dot" :style="{background: t.color, width: '30px', height: '30px', borderRadius: '50%', cursor: 'pointer', border: activeTheme === t.color ? '3px solid #000' : '1px solid #ddd'}"
               @click="setTheme(t.color)"></div>
        </div>
      </div>

      <button class="btn btn-pill" @click="screen = 'game'">START GAME</button>
    </div>

    <div v-if="screen === 'game'" class="w-100 text-center animate__animated animate__fadeIn">
      <div class="position-absolute top-0 start-0 p-3" @click="screen = 'menu'"><i class="bi bi-chevron-left h4"></i></div>
      
      <div class="d-flex justify-content-between px-4 mb-4" style="max-width: 400px; margin: auto;">
        <span class="badge border text-dark">LVL: {{ level }}</span>
        <span class="badge border text-dark">BEST: {{ highScore }}</span>
      </div>

      <div class="grid" :style="{gridTemplateColumns: `repeat(${gridSize}, 1fr)`}">
        <div v-for="(c, i) in (gridSize * gridSize)" :key="i" 
             class="cell" :class="cellLogic(i)" @click="hit(i)"></div>
      </div>

      <button v-if="status === 'idle'" class="btn btn-pill" @click="play">TAP TO START</button>
    </div>

    <div v-if="pop.show" class="popup-overlay animate__animated animate__fadeIn">
      <div class="popup-content animate__animated animate__zoomIn">
        <h2 class="fw-bold">{{ pop.title }}</h2>
        <p class="text-muted">{{ pop.msg }}</p>
        <button class="btn btn-pill w-100 mt-3" 
                :style="{background: activeTheme, color: '#fff', border: 'none'}" @click="next">
          CONTINUE
        </button>
      </div>
    </div>

  </template>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: true,
      screen: 'menu',
      level: 1,
      highScore: localStorage.getItem('hs') || 0,
      jsonData: null,
      activeTheme: '#34495e',
      status: 'idle',
      gridSize: 3,
      pattern: [],
      userPick: [],
      pop: { show: false, title: '', msg: '', win: false }
    }
  },
  mounted() {
    // Artificial delay (optional) taaki animation dikhe, ya direct fetch use karein
    fetch('config.json')
      .then(r => r.json())
      .then(data => {
        this.jsonData = data;
        // Data load hone par loading false
        setTimeout(() => { this.loading = false; }, 800); 
      })
      .catch(e => {
        console.error("JSON load error!");
        this.loading = false;
      });
  },
  methods: {
    setTheme(c) {
      this.activeTheme = c;
      document.documentElement.style.setProperty('--p-color', c);
    },
    play() {
      this.status = 'memo';
      this.userPick = [];
      this.pattern = [];
      this.gridSize = Math.floor(this.level / 4) + 3;
      const pCount = 2 + Math.floor(this.level / 2);
      while(this.pattern.length < pCount) {
        let r = Math.floor(Math.random() * (this.gridSize * this.gridSize));
        if(!this.pattern.includes(r)) this.pattern.push(r);
      }
      setTimeout(() => { this.status = 'play'; }, 1200);
    },
    hit(i) {
      if(this.status !== 'play' || this.userPick.includes(i)) return;
      this.userPick.push(i);
      if(!this.pattern.includes(i)) {
        this.pop = { show: true, win: false, title: "Game Over", msg: "Try again!" };
        return;
      }
      if(this.userPick.length === this.pattern.length) {
        if(this.level > this.highScore) { this.highScore = this.level; localStorage.setItem('hs', this.level); }
        this.pop = { show: true, win: true, title: "Well Done!", msg: "Level complete." };
      }
    },
    next() {
      this.pop.show = false;
      this.level = this.pop.win ? this.level + 1 : 1;
      this.play();
    },
    cellLogic(i) {
      if(this.status === 'memo' && this.pattern.includes(i)) return 'active';
      if(this.userPick.includes(i)) return this.pattern.includes(i) ? 'correct' : 'wrong';
      return '';
    }
  }
}).mount('#app');
</script>
</body>
</html>
